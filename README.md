# Mattermost Bugsnag Integration Plugin

Техническое задание и черновая архитектура для плагина Mattermost, интегрированного с Bugsnag. Проект нацелен на автоматическую доставку уведомлений об ошибках в каналы Mattermost, быстрые действия по статусам и удобное администрирование через System Console.

## Основные возможности

- Подключение к Bugsnag через персональный API token и опциональный Organization ID.
- Получение событий ошибок по Webhook и публикация карточек с кнопками действий в выбранные каналы Mattermost.
- Отслеживание статусов, повторений и времени последнего происшествия с обновлениями в тредах.
- Маппинг пользователей Bugsnag ↔ Mattermost для корректных упоминаний и reassignment из карточек.
- Админ‑UI в System Console: подключение, привязка проектов к каналам, правила уведомлений и настройка пользовательских соответствий.

## Архитектура на высоком уровне

### Server Plugin (Go)

- Эндпоинты `/plugins/bugsnag/webhook` для приёма событий и `/plugins/bugsnag/actions` для интерактивных кнопок.
- Клиент Bugsnag API для получения проектов, ошибок и управления статусами/исполнителями.
- Использование Mattermost Plugin API для создания/обновления постов и хранения мэппингов в KV.
- Планируется периодический синк активных ошибок для актуализации статистики.

### Webapp Plugin (React)

- Страница настроек плагина в System Console с вкладками Connection, Projects & Channels, User Mapping и Notification Rules.
- Опциональные UI-расширения (кнопка в channel header, RHS панель) для просмотра деталей ошибок.

### Bugsnag

- Webhook, настраиваемый в Bugsnag UI, отправляет события на публичный URL плагина с секретным токеном.
- REST API используется для чтения данных об ошибках/проектах и выполнения действий (изменение статуса, назначение исполнителя).

## Основные пользовательские сценарии

1. **Подключение**: администратор вводит API token и, при необходимости, Organization ID. Плагин запрашивает список организаций/проектов и сохраняет их в KV.
2. **Настройка Webhook**: в админке отображается URL вида `https://<mm-host>/plugins/bugsnag/webhook?token=<secret>`, который добавляется в настройках Bugsnag проекта.
3. **Поступление ошибок**: Webhook-события фильтруются по выбранным каналам, окружениям и типам событий; для новых ошибок создаются карточки, для существующих — обновляются метрики и добавляются записи в тред.
4. **Интерактивные действия**: кнопки «Assign to me», «Resolve», «Ignore», «Open in Bugsnag» вызывают серверный хендлер, который сопоставляет пользователей и обновляет состояние ошибки через Bugsnag API.
5. **Периодический синк**: активные ошибки опрашиваются с заданным интервалом; карточки и треды дополняются свежей статистикой и значимыми изменениями.

## Дополнительные материалы

- Полное техническое описание требований, потоков данных и UI доступно в [`initial-plan.md`](initial-plan.md).

## Текущее состояние репозитория

- Добавлен минимальный каркас server-плагина на Go (`server/`):
  - `plugin.go` регистрирует эндпоинты `/webhook` и `/actions` через `ServeHTTP` и загружает конфигурацию.
  - `webhook.go` и `actions.go` принимают payload’ы, логируют их и отвечают заглушками (готовы для расширения).
  - `message_templates.go` содержит черновые структуры карточек и действий.
- `plugin.json` описывает манифест плагина, настройки админки и ожидаемые артефакты сборки.
- В `docs/` лежат примеры payload’ов и чек-лист TODO для превращения каркаса в рабочий билд.

Следующий шаг — скопировать Makefile и webapp из `mattermost-plugin-starter-template`, привязать REST-ручки под админку и реализовать логику webhook/interactive действий согласно `docs/todo.md`.

