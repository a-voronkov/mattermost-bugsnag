# Local Mattermost test environment

The repository does not currently include a runnable Mattermost instance, so
local testing requires bringing up your own server. These steps outline how to
start a temporary Mattermost Team Edition container, enable plugin uploads, and
install the Bugsnag plugin bundle once it is built.

## Prerequisites

- Docker
- `mmctl` (Mattermost CLI) installed on your host to manage the running server
- A plugin bundle (`.tar.gz`) generated by `make dist` after adding the
  Makefile/webapp from the Mattermost plugin starter template
- Internet access to fetch Go dependencies when running `go mod tidy` or
  `go test` inside the `server/` module; offline environments will fail while
  downloading `mattermost-server` packages.

## 1) Start Mattermost locally

```bash
docker run -d --name mm-bugsnag-dev \
  -p 8065:8065 \
  mattermost/mattermost-team-edition:release-9.11
```

Wait until the container is healthy, then create an admin user and a sample
team/channel for plugin notifications:

```bash
# Create admin user
docker exec mm-bugsnag-dev mattermost user create \
  --system-admin --email admin@example.com --password Passw0rd! --username admin

# Create a team and channel for plugin posts
docker exec mm-bugsnag-dev mattermost team create --name bugsnag --display_name "Bugsnag"
docker exec mm-bugsnag-dev mattermost channel create \
  --team bugsnag --name alerts --display_name "Alerts"
```

## 2) Enable plugin uploads

```bash
# Allow plugins to be uploaded from the UI/API
docker exec mm-bugsnag-dev mattermost config set PluginSettings.EnableUploads true

# Restart to apply the config change
docker restart mm-bugsnag-dev
```

## 3) Build the plugin bundle

After copying the Makefile and webapp from `mattermost-plugin-starter-template`,
produce the plugin distribution archive:

```bash
# inside this repository
make dist
```

This should emit `dist/mattermost-bugsnag.tar.gz` (or similarly named) for
installation.

## 4) Install the plugin into Mattermost

Use `mmctl` to upload and enable the bundle:

```bash
# From the repository root (replace filename if different)
mmctl --local plugin add dist/mattermost-bugsnag.tar.gz
mmctl --local plugin enable mattermost-bugsnag
```

If you prefer, the bundle can also be uploaded via the System Console under
**Plugin Management → Management → Upload Plugin**.

## 5) Verify plugin endpoints

With the plugin enabled, you can sanity-check the webhook/action endpoints using
cURL (replace the token and host as appropriate):

```bash
curl -i -X POST "http://localhost:8065/plugins/bugsnag/webhook?token=test" \
  -H 'Content-Type: application/json' \
  -d '{"project_id":"demo","event":"test","channel_id":"<channel-id>"}'
```

Successful responses confirm the plugin is registered and reachable inside your
local Mattermost instance.
